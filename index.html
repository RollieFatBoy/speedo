<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="light-content">
<title>MOTO SPEED</title>
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&family=Share+Tech+Mono&family=Rajdhani:wght@600;700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg:           #252629;
  --chrome:       linear-gradient(145deg, #2e3035 0%, #26282c 50%, #1e2023 100%);
  --card:         linear-gradient(150deg, #2e3035 0%, #252729 100%);
  --dark:         #f0f1f3;
  --mid:          #b0b4bc;
  --dim:          #686c75;
  --green:        #2ecc71;
  --amber:        #e67e22;
  --red:          #e74c3c;
  --border-hi:    rgba(255,255,255,0.08);
  --border-lo:    rgba(0,0,0,0.35);
  --shadow:       0 2px 14px rgba(0,0,0,0.4), 0 1px 3px rgba(0,0,0,0.3);
  --inset:        inset 0 1px 0 rgba(255,255,255,0.06);
}

html, body {
  width: 100%; height: 100%;
  overflow: hidden;
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
  background: var(--bg);
}

body {
  display: grid;
  grid-template-columns: 1fr 1px minmax(170px, 28vw);
  height: 100dvh;
  height: -webkit-fill-available;
  padding: env(safe-area-inset-top,0) env(safe-area-inset-right,0) env(safe-area-inset-bottom,0) env(safe-area-inset-left,0);
  font-family: 'Rajdhani', sans-serif;
}

/* subtle dark vignette */
body::before {
  content: '';
  position: fixed; inset: 0; pointer-events: none; z-index: 500;
  background: radial-gradient(ellipse at center, transparent 60%, rgba(0,0,0,0.25) 100%);
}

/* ═══════════════════════ GAUGE COLUMN ═══════════════════════ */
.gauge-col {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 8px;
}

.gauge-wrap {
  position: relative;
  /* Keep gauge square and as large as fits */
  width:  min(calc(100vh - 16px), calc(72vw - 16px));
  height: min(calc(100vh - 16px), calc(72vw - 16px));
}

.gauge-svg { width: 100%; height: 100%; overflow: visible; }

/* ═══════════════════════ DIVIDER ═══════════════════════ */
.divider {
  background: linear-gradient(to bottom, transparent 5%, rgba(0,0,0,0.4) 20%, rgba(0,0,0,0.4) 80%, transparent 95%);
}

/* ═══════════════════════ INFO COLUMN ═══════════════════════ */
.info-col {
  display: flex;
  flex-direction: column;
  gap: 7px;
  padding: 8px 10px;
}

.card {
  background: var(--card);
  border: 1px solid var(--border-lo);
  border-top-color: var(--border-hi);
  border-radius: 9px;
  box-shadow: var(--shadow), var(--inset);
}

/* Clock */
.clock {
  padding: 8px 10px;
  text-align: center;
}
.clock-time {
  font-family: 'Share Tech Mono', monospace;
  font-size: clamp(28px, 6.5vh, 52px);
  color: var(--dark);
  letter-spacing: 0.03em;
  line-height: 1;
}
.clock-date {
  font-family: 'Share Tech Mono', monospace;
  font-size: clamp(10px, 1.8vh, 14px);
  color: var(--dim);
  letter-spacing: 0.2em;
  margin-top: 5px;
}

/* Stats */
.stats {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 7px;
  flex: 1;
}
.stat {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 6px 4px;
  min-height: 0;
}
.stat.wide { grid-column: span 2; }
.s-val {
  font-family: 'Oswald', sans-serif;
  font-size: clamp(22px, 4.5vh, 38px);
  font-weight: 700;
  color: var(--dark);
  line-height: 1;
}
.s-lbl {
  font-family: 'Share Tech Mono', monospace;
  font-size: clamp(8px, 1.4vh, 11px);
  color: var(--dim);
  letter-spacing: 0.2em;
  margin-top: 3px;
}

/* Status */
.status {
  font-family: 'Share Tech Mono', monospace;
  font-size: clamp(8px, 1.3vh, 11px);
  color: var(--dim);
  letter-spacing: 0.1em;
  text-align: center;
  padding: 2px 0;
}
.status.ok   { color: var(--green); }
.status.warn { color: var(--amber); }
.status.err  { color: var(--red);   }

/* Buttons */
.btns {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 6px;
}
button {
  font-family: 'Rajdhani', sans-serif;
  font-weight: 700;
  font-size: clamp(13px, 2.2vh, 18px);
  letter-spacing: 0.07em;
  padding: 8px 4px;
  border-radius: 7px;
  border: 1px solid var(--border-lo);
  background: var(--card);
  color: var(--mid);
  cursor: pointer;
  box-shadow: var(--shadow), var(--inset);
  transition: all 0.12s;
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}
button:active { box-shadow: inset 0 2px 5px rgba(0,0,0,0.4); transform: translateY(1px); }
#startBtn {
  grid-column: span 2;
  font-size: clamp(24px, 5vh, 42px);
  padding: 16px 4px;
  color: #e74c3c;
  border-color: rgba(231,76,60,0.5);
  letter-spacing: 0.2em;
}
#startBtn.live {
  background: linear-gradient(155deg,#e74c3c,#c0392b);
  color: #fff;
  border-color: #a93226;
  box-shadow: 0 3px 14px rgba(231,76,60,0.45), var(--inset);
}

/* Speed overlay */
.speed-overlay {
  position: absolute; inset: 0;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  pointer-events: none;
}
.speed-box {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border: 2px solid #e74c3c;
  border-radius: 10px;
  padding: 4px 16px 6px;
  background: rgba(30,31,35,0.55);
  box-shadow: 0 0 12px rgba(231,76,60,0.2), inset 0 1px 0 rgba(255,255,255,0.04);
}
.speed-num {
  font-family: 'Oswald', sans-serif;
  font-size: clamp(72px, 19vh, 150px);
  font-weight: 700;
  color: #ffffff;
  line-height: 0.88;
  letter-spacing: -2px;
  transition: color 0.25s;
  text-shadow: 0 2px 10px rgba(0,0,0,0.6);
}
.speed-num.warn   { color: #e67e22; }
.speed-num.danger { color: #e74c3c; }
.speed-unit {
  font-family: 'Share Tech Mono', monospace;
  font-size: clamp(11px, 2.2vh, 18px);
  color: #888c96;
  letter-spacing: 0.3em;
  margin-top: 4px;
}

@keyframes flash { 0%,100%{opacity:1} 50%{opacity:0.1} }
.flash { animation: flash 0.5s ease 3; }
</style>
</head>
<body>

<!-- GAUGE -->
<div class="gauge-col">
  <div class="gauge-wrap">
    <svg class="gauge-svg" viewBox="0 0 300 300">
      <defs>
        <radialGradient id="faceGrad" cx="40%" cy="35%" r="65%">
          <stop offset="0%"   stop-color="#36393f"/>
          <stop offset="60%"  stop-color="#2b2d32"/>
          <stop offset="100%" stop-color="#222428"/>
        </radialGradient>
        <radialGradient id="hubGrad" cx="35%" cy="30%" r="70%">
          <stop offset="0%"   stop-color="#3a3d44"/>
          <stop offset="100%" stop-color="#1e2024"/>
        </radialGradient>
        <filter id="needleGlow" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur stdDeviation="2.5" result="b"/>
          <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge>
        </filter>
        <filter id="dropShadow">
          <feDropShadow dx="0" dy="3" stdDeviation="5" flood-opacity="0.12"/>
        </filter>
      </defs>

      <!-- Outer bezel -->
      <circle cx="150" cy="150" r="142" fill="url(#faceGrad)" filter="url(#dropShadow)"/>
      <circle cx="150" cy="150" r="142" fill="none" stroke="rgba(255,255,255,0.7)" stroke-width="1"/>
      <circle cx="150" cy="150" r="140" fill="none" stroke="rgba(0,0,0,0.07)" stroke-width="2"/>

      <!-- Face -->
      <circle cx="150" cy="150" r="136" fill="url(#faceGrad)"/>

      <!-- Arc track (180° from 9 o'clock → 12 o'clock → 3 o'clock) -->
      <!-- R=118, circumference=741.42, half=370.71 -->
      <!-- rotate(180) starts dasharray at 9 o'clock going clockwise -->
      <circle cx="150" cy="150" r="118" fill="none"
        stroke="#3a3d44" stroke-width="18" stroke-linecap="butt"
        stroke-dasharray="370.71 9999"
        transform="rotate(180 150 150)"/>

      <!-- Zone arcs (rendered on top of track, behind fill) -->
      <!-- Green 0–60: 0 to 185.36 dash (50% of 370.71) -->
      <circle id="zoneGreen" cx="150" cy="150" r="118" fill="none"
        stroke="#27ae60" stroke-width="16" stroke-linecap="butt" opacity="0.28"
        stroke-dasharray="185.35 9999" stroke-dashoffset="0"
        transform="rotate(180 150 150)"/>
      <!-- Amber 60–110: offset 185.35, length 154.46 -->
      <circle id="zoneAmber" cx="150" cy="150" r="118" fill="none"
        stroke="#e67e22" stroke-width="16" stroke-linecap="butt" opacity="0.28"
        stroke-dasharray="154.46 9999" stroke-dashoffset="-185.35"
        transform="rotate(180 150 150)"/>
      <!-- Red 110–120: offset 339.82, length 30.89 -->
      <circle id="zoneRed" cx="150" cy="150" r="118" fill="none"
        stroke="#c0392b" stroke-width="16" stroke-linecap="butt" opacity="0.35"
        stroke-dasharray="30.89 9999" stroke-dashoffset="-339.82"
        transform="rotate(180 150 150)"/>

      <!-- Speed fill arc -->
      <circle class="gauge-fill" id="arcFill" cx="150" cy="150" r="118" fill="none"
        stroke="#27ae60" stroke-width="18" stroke-linecap="butt"
        stroke-dasharray="0 9999" stroke-dashoffset="0"
        transform="rotate(180 150 150)"
        style="transition: stroke-dasharray 0.3s ease, stroke 0.3s ease; filter: drop-shadow(0 0 4px rgba(39,174,96,0.4));"/>

      <!-- Ticks & labels -->
      <g id="ticks"></g>

      <!-- Centre disc -->
      <circle cx="150" cy="150" r="55" fill="url(#faceGrad)"/>
      <circle cx="150" cy="150" r="55" fill="none" stroke="rgba(255,255,255,0.55)" stroke-width="1.5"/>
      <circle cx="150" cy="150" r="53" fill="none" stroke="rgba(0,0,0,0.1)" stroke-width="1"/>

      <!-- Needle (points UP by default; at 0 km/h rotated −90° → points LEFT) -->
      <g id="needle" transform="rotate(-90 150 150)" style="transition: transform 0.3s cubic-bezier(0.23,1,0.32,1);">
        <!-- tail -->
        <line x1="150" y1="150" x2="150" y2="162" stroke="#555" stroke-width="3" stroke-linecap="round"/>
        <!-- shaft -->
        <polygon points="149,150 151,150 151.5,52 148.5,52" fill="#c0392b" filter="url(#needleGlow)"/>
        <!-- tip -->
        <polygon points="150,38 148,58 152,58" fill="#c0392b"/>
        <!-- hub -->
        <circle cx="150" cy="150" r="8" fill="url(#hubGrad)" stroke="rgba(255,255,255,0.6)" stroke-width="1.5"/>
        <circle cx="150" cy="150" r="3.5" fill="#1a1c20"/>
      </g>
    </svg>

    <div class="speed-overlay">
      <div class="speed-box">
        <div class="speed-num" id="speedNum">0</div>
        <div class="speed-unit" id="unitLbl">KM/H</div>
      </div>
    </div>
  </div>
</div>

<!-- DIVIDER -->
<div class="divider"></div>

<!-- INFO PANEL -->
<div class="info-col">

  <div class="card clock">
    <div class="clock-time" id="clockTime">--:--:--</div>
    <div class="clock-date" id="clockDate">---</div>
  </div>

  <div class="stats" style="flex:1">
    <div class="card stat">
      <div class="s-val" id="maxSpd">0</div>
      <div class="s-lbl">MAX</div>
    </div>
    <div class="card stat">
      <div class="s-val" id="avgSpd">0</div>
      <div class="s-lbl">AVG</div>
    </div>
    <div class="card stat wide">
      <div class="s-val" id="tripDist">0.0</div>
      <div class="s-lbl" id="distLbl">KM TRIP</div>
    </div>
  </div>

  <div class="status" id="status">PRESS START</div>

  <div class="btns">
    <button id="startBtn" onclick="toggleTracking()">START</button>
    <button onclick="toggleUnit()">MPH / KMH</button>
    <button onclick="resetStats()">RESET</button>
  </div>

</div>

<script>
// ─── Geometry ─────────────────────────────────────────────────────────────
// Arc: 180° semicircle, 9 o'clock (left) → 12 o'clock (top) → 3 o'clock (right)
// SVG angle convention: 0° = 3 o'clock, clockwise positive
// Needle default = pointing UP (12 o'clock = -90° in SVG rotation terms)
// At 0 km/h: needle at -90° (pointing left = 9 o'clock)
// At 60 km/h: needle at 0° (pointing up = 12 o'clock)
// At 120 km/h: needle at +90° (pointing right = 3 o'clock)

const MAX_KMH   = 120;
const ARC_DEG   = 180;  // total sweep
const R         = 118;
const ARC_LEN   = Math.PI * R;           // 370.71
const START_ANG = -90;                   // needle angle at 0 km/h

// Zone lengths on the arc
const Z60  = (60  / MAX_KMH) * ARC_LEN; // 185.35
const Z110 = (110 / MAX_KMH) * ARC_LEN; // 339.82
const Z120 = ARC_LEN;                    // 370.71

// ─── State ────────────────────────────────────────────────────────────────
let watchId=null, running=false, useKmh=true;
let speedKmh=0, maxKmh=0, totalDist=0;
let speedSums=0, speedCount=0, lastPos=null;

// ─── Draw ticks ───────────────────────────────────────────────────────────
// SVG angle for a given speed:
// At 0 km/h → SVG 180° (left); at 120 → SVG 0°/360° (right)
// svgAngle(v) = 180° - (v/120)*180° = 180°(1 - v/120)
// But in radians for Math.cos/sin: radians = svgAngle * π/180
function speedToSVGRad(v) {
  return (180 - (v / MAX_KMH) * 180) * Math.PI / 180;
}

const tG = document.getElementById('ticks');
const cx = 150, cy = 150;

// Minor ticks every 10
[10,30,50,70,90].forEach(v => {
  const a = speedToSVGRad(v);
  const r1 = 108, r2 = 116;
  const ln = document.createElementNS('http://www.w3.org/2000/svg','line');
  ln.setAttribute('x1', cx + r1*Math.cos(a)); ln.setAttribute('y1', cy - r1*Math.sin(a));
  ln.setAttribute('x2', cx + r2*Math.cos(a)); ln.setAttribute('y2', cy - r2*Math.sin(a));
  ln.setAttribute('stroke','#50545e'); ln.setAttribute('stroke-width','1.2');
  tG.appendChild(ln);
});

// Major ticks + labels every 20, plus 110 highlight
const majorTicks = [
  { v:0,   color:'#606470', highlight:false },
  { v:20,  color:'#606470', highlight:false },
  { v:40,  color:'#606470', highlight:false },
  { v:60,  color:'#2ecc71', highlight:true  },
  { v:80,  color:'#606470', highlight:false },
  { v:100, color:'#606470', highlight:false },
  { v:110, color:'#e74c3c', highlight:true  },
  { v:120, color:'#606470', highlight:false },
];

majorTicks.forEach(({ v, color, highlight }) => {
  const a = speedToSVGRad(v);
  // Note: SVG y increases downward, but our arc goes UP, so y = cy - r*sin(a)
  const r1 = highlight ? 92 : 98;
  const r2 = 128;

  const ln = document.createElementNS('http://www.w3.org/2000/svg','line');
  ln.setAttribute('x1', cx + r1*Math.cos(a)); ln.setAttribute('y1', cy - r1*Math.sin(a));
  ln.setAttribute('x2', cx + r2*Math.cos(a)); ln.setAttribute('y2', cy - r2*Math.sin(a));
  ln.setAttribute('stroke', color);
  ln.setAttribute('stroke-width', highlight ? '3.5' : '2.2');
  tG.appendChild(ln);

  // Label
  const labelR = highlight ? 82 : 87;
  const lx = cx + labelR * Math.cos(a);
  const ly = cy - labelR * Math.sin(a);

  const t = document.createElementNS('http://www.w3.org/2000/svg','text');
  t.setAttribute('x', lx);
  t.setAttribute('y', ly);
  t.setAttribute('text-anchor','middle');
  t.setAttribute('dominant-baseline','middle');
  t.setAttribute('fill', color);
  t.setAttribute('font-family',"'Share Tech Mono', monospace");
  t.setAttribute('font-size', highlight ? '11' : '10');
  t.setAttribute('font-weight', highlight ? 'bold' : 'normal');
  t.textContent = v;
  tG.appendChild(t);
});

// Highlight marker lines for 60 and 110 (extra visual emphasis on the arc edge)
[60, 110].forEach(v => {
  const a = speedToSVGRad(v);
  const col = v === 60 ? '#1e8a3e' : '#b03020';
  // small dot on arc
  const dot = document.createElementNS('http://www.w3.org/2000/svg','circle');
  dot.setAttribute('cx', cx + 118*Math.cos(a));
  dot.setAttribute('cy', cy - 118*Math.sin(a));
  dot.setAttribute('r','4');
  dot.setAttribute('fill', col);
  dot.setAttribute('opacity','0.85');
  tG.appendChild(dot);
});

// ─── Clock ────────────────────────────────────────────────────────────────
const DAYS  = ['SUN','MON','TUE','WED','THU','FRI','SAT'];
const MONTHS= ['JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG','SEP','OCT','NOV','DEC'];
function tickClock() {
  const n = new Date();
  document.getElementById('clockTime').textContent =
    [n.getHours(), n.getMinutes(), n.getSeconds()].map(x => String(x).padStart(2,'0')).join(':');
  document.getElementById('clockDate').textContent =
    `${DAYS[n.getDay()]}  ${n.getDate()} ${MONTHS[n.getMonth()]} ${n.getFullYear()}`;
}
tickClock();
setInterval(tickClock, 1000);

// ─── Speed rendering ──────────────────────────────────────────────────────
function setSpeed(kmh) {
  speedKmh = kmh;
  const display = useKmh ? Math.round(kmh) : Math.round(kmh * 0.621371);
  const el = document.getElementById('speedNum');
  el.textContent = display;
  el.classList.remove('warn','danger');
  if      (kmh > 110) el.classList.add('danger');
  else if (kmh > 60)  el.classList.add('warn');

  const frac = Math.min(kmh / MAX_KMH, 1);
  const fill  = frac * ARC_LEN;
  const af = document.getElementById('arcFill');
  af.style.strokeDasharray = `${fill} 9999`;

  // Arc colour and glow match zone
  let arcCol, glowCol;
  if      (kmh > 110) { arcCol = '#c0392b'; glowCol = 'rgba(192,57,43,0.45)'; }
  else if (kmh > 60)  { arcCol = '#e67e22'; glowCol = 'rgba(230,126,34,0.4)'; }
  else                { arcCol = '#27ae60'; glowCol = 'rgba(39,174,96,0.4)'; }
  af.style.stroke = arcCol;
  af.style.filter = `drop-shadow(0 0 5px ${glowCol})`;

  // Needle: -90° at 0 km/h, +90° at 120 km/h
  const needleAng = START_ANG + frac * ARC_DEG;
  document.getElementById('needle').style.transform = `rotate(${needleAng}deg)`;
  document.getElementById('needle').style.transformOrigin = '150px 150px';

  // Max
  if (kmh > maxKmh) {
    maxKmh = kmh;
    const mel = document.getElementById('maxSpd');
    mel.textContent = useKmh ? Math.round(maxKmh) : Math.round(maxKmh * 0.621371);
    mel.classList.add('flash');
    setTimeout(() => mel.classList.remove('flash'), 1800);
  }

  // Avg
  if (running && kmh > 0) { speedSums += kmh; speedCount++; }
  const avg = speedCount ? speedSums / speedCount : 0;
  document.getElementById('avgSpd').textContent = useKmh ? Math.round(avg) : Math.round(avg * 0.621371);
}

// ─── Unit toggle ──────────────────────────────────────────────────────────
function toggleUnit() {
  useKmh = !useKmh;
  document.getElementById('unitLbl').textContent  = useKmh ? 'KM/H' : 'MPH';
  document.getElementById('distLbl').textContent  = useKmh ? 'KM TRIP' : 'MI TRIP';
  document.getElementById('tripDist').textContent = useKmh
    ? (totalDist / 1000).toFixed(1) : (totalDist / 1609.34).toFixed(1);
  const avg = speedCount ? speedSums / speedCount : 0;
  document.getElementById('maxSpd').textContent = useKmh ? Math.round(maxKmh) : Math.round(maxKmh * 0.621371);
  document.getElementById('avgSpd').textContent = useKmh ? Math.round(avg)    : Math.round(avg * 0.621371);
  setSpeed(speedKmh);
}

// ─── Reset ────────────────────────────────────────────────────────────────
function resetStats() {
  maxKmh=0; totalDist=0; speedSums=0; speedCount=0; lastPos=null;
  document.getElementById('maxSpd').textContent  = '0';
  document.getElementById('avgSpd').textContent  = '0';
  document.getElementById('tripDist').textContent = '0.0';
  setSpeed(0);
}

// ─── Status ───────────────────────────────────────────────────────────────
function setStatus(msg, cls) {
  const el = document.getElementById('status');
  el.textContent = msg;
  el.className = 'status' + (cls ? ' ' + cls : '');
}

// ─── GPS ──────────────────────────────────────────────────────────────────
function toggleTracking() { running ? stopTracking() : startTracking(); }

function startTracking() {
  if (!navigator.geolocation) { setStatus('GPS NOT SUPPORTED', 'err'); return; }
  setStatus('ACQUIRING SIGNAL…', 'warn');
  watchId = navigator.geolocation.watchPosition(onPos, onErr,
    { enableHighAccuracy: true, maximumAge: 0, timeout: 7000 });
  running = true;
  const b = document.getElementById('startBtn');
  b.textContent = 'STOP'; b.classList.add('live');
}

function stopTracking() {
  if (watchId !== null) navigator.geolocation.clearWatch(watchId);
  watchId = null; running = false;
  setSpeed(0);
  const b = document.getElementById('startBtn');
  b.textContent = 'START'; b.classList.remove('live');
  setStatus('STOPPED');
}

function onPos(pos) {
  const { speed, latitude, longitude, accuracy } = pos.coords;
  const kmh = (speed !== null && speed >= 0) ? speed * 3.6 : 0;
  if (lastPos) {
    totalDist += haversine(lastPos.lat, lastPos.lng, latitude, longitude);
    document.getElementById('tripDist').textContent = useKmh
      ? (totalDist / 1000).toFixed(1) : (totalDist / 1609.34).toFixed(1);
  }
  lastPos = { lat: latitude, lng: longitude };
  setSpeed(kmh);
  setStatus(`GPS  ±${Math.round(accuracy)}m`, 'ok');
}

function onErr(err) {
  const msgs = { 1:'PERMISSION DENIED', 2:'SIGNAL LOST', 3:'GPS TIMEOUT' };
  setStatus(msgs[err.code] || 'GPS ERROR', 'err');
}

function haversine(a, b, c, d) {
  const R = 6371000, r = Math.PI / 180;
  const x = Math.sin(((c-a)*r)/2)**2 + Math.cos(a*r)*Math.cos(c*r)*Math.sin(((d-b)*r)/2)**2;
  return R * 2 * Math.atan2(Math.sqrt(x), Math.sqrt(1-x));
}

// ─── Wake lock ────────────────────────────────────────────────────────────
async function keepAwake() {
  if ('wakeLock' in navigator) try { await navigator.wakeLock.request('screen'); } catch(_) {}
}
keepAwake();
document.addEventListener('visibilitychange', () => { if (!document.hidden) keepAwake(); });
</script>
</body>
</html>
